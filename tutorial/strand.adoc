:last-update-label!:
:am-version: latest
:source-highlighter: rouge
:rouge-style: base16.monokai

ifdef::env-github[:am-base-path: ../../main]
ifndef::env-github[:am-base-path: ../..]
ifdef::env-github[:api-base: link:https://redboltz.github.io/async_mqtt/doc/{am-version}/html]
ifndef::env-github[:api-base: link:../api]

= Strand

endpoint has boost asio's strand internally.CompletionToken is called in the endpoint's strand. Strand is useful to avoid locks and mutexes.
You can get the strand from the endpoint using `strand()` function and use it as the executor for Boost.Asio's async functions like `steady_timer`.

It could be annoying calling async APIs from obiously in the strand context. e.g. in the recv() CompletionToken. async_mqtt provides some of sync APIs.
Here is the list of **sync** APIs that can be called only in the strand.

|===
|endpoint member function | effects

|{api-base}/++classasync__mqtt_1_1basic__endpoint.html#af0f43d8cdb723fea82a2b0b8a37e5953++[acquire_unique_packet_id]|Acquire the new unique packet_id
|{api-base}/++classasync__mqtt_1_1basic__endpoint.html#a69d7bdefdbcfe71c7fa1ce40cbc583b6++[register_packet_id]|Register the packet_id
|{api-base}/++classasync__mqtt_1_1basic__endpoint.html#a23bd0f62e5f5e27cb715e37b47b6b754++[release_packet_id]|Release the packet_id
|{api-base}/++classasync__mqtt_1_1basic__endpoint.html#a4373b14f01a1954780a55fa108618734++[get_qos2_publish_handled_pids]|Get already PUBLISH recv CompletionToken is invoked packet_ids
|{api-base}/++classasync__mqtt_1_1basic__endpoint.html#a78a9e9c6a92f5cb72c87de37bb58ae94++[restore_qos2_publish_handled_pids]|Restore already PUBLISH recv CompletionToken is invoked packet_ids
|{api-base}/++classasync__mqtt_1_1basic__endpoint.html#ae60e7fe678e7844c33cd45fed8db028c++[restore_packets]|Restore pacets as stored packets
|{api-base}/++classasync__mqtt_1_1basic__endpoint.html#a205376516c6337bfb5bbff9c04747de7++[get_stored_packets]|Get stored packets
|{api-base}/++classasync__mqtt_1_1basic__endpoint.html#a501a5d70d41e7e019bdd606ed0885cef++[get_protocol_version]|Get MQTT protocol version
|===

acquire_unique_packet_id, register_packet_id, release_packet_id, restore_packets, and get_stored_packets have async version (the same name overload) to call out of strand.
